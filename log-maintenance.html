<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log Input</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { background:#1e1e2f; color:white; font-family:Arial; padding:20px }
    h2 { color:cyan }
    table { width:100%; border-collapse:collapse; margin-top:15px }
    th,td { border:1px solid #444; padding:8px; text-align:left }
    th { background:#2a2a3d }
    tr:nth-child(even) { background:#333 }
    a.btn-back { background:crimson; color:white; padding:6px 12px; border-radius:6px; text-decoration:none; margin-bottom:15px; display:inline-block }
    .btn-delete { background:#ff4757; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; font-size:12px }
    .btn-delete:hover { background:#ff6b81 }
  </style>
</head>
<body>
  <h2>Log Input Data</h2>
  <a href="dashboard-maintenance.html" class="btn-back">Back to Dashboard</a>
  <table id="logTable">
    <thead>
      <tr>
        <th>Date</th><th>Machine</th><th>Category</th><th>Trouble</th><th>Analysis</th><th>Repair</th>
        <th>Lost Time</th><th>PIC</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const { createClient } = supabase;
    const supabaseUrl = "https://skjtzbldpvmacmotdomr.supabase.co"; 
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNranR6YmxkcHZtYWNtb3Rkb21yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0Nzk4ODYsImV4cCI6MjA3MzA1NTg4Nn0.u8Zg2k7us_wHnamqplRYZ7rI6ls68zRZ6iLgfitTviM"; 
    const supabaseClient = createClient(supabaseUrl, supabaseKey);

    async function loadLog() {
      // Ganti dengan nama tabel yang benar di Supabase
      const tableName = "lost_time_maintenance"; // atau "Lost_time_maintenance" atau "public.lost_time_maintenance"
      
      const { data, error } = await supabaseClient
        .from(tableName)
        .select("*")
        .order("date",{ascending:false});
      
      if (error) { 
        console.error("Error loading data:", error); 
        alert("Error loading data: " + error.message);
        return; 
      }

      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";
      
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.date}</td>
          <td>${row.machine}</td>
          <td>${row.category}</td>
          <td>${row.trouble}</td>
          <td>${row.analysis || ""}</td>
          <td>${row.repair || ""}</td>
          <td>${row.lost_time}</td>
          <td>${row.pic || ""}</td>
          <td>
            <button class="btn-delete" data-id="${row.id}">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Tambahkan event listener untuk semua button delete
      document.querySelectorAll('.btn-delete').forEach(button => {
        button.addEventListener('click', function() {
          const id = this.getAttribute('data-id');
          deleteRecord(id);
        });
      });
    }

    async function deleteRecord(id) {
      if (!confirm("Are you sure you want to delete this record?")) {
        return;
      }

      // Ganti dengan nama tabel yang benar di Supabase
      const tableName = "lost_time_maintenance"; // atau "Lost_time_maintenance" atau "public.lost_time_maintenance"
      
      const { error } = await supabaseClient
        .from(tableName)
        .delete()
        .eq('id', id);

      if (error) {
        console.error("Error deleting record:", error);
        alert("Error deleting record: " + error.message);
      } else {
        alert("Record deleted successfully!");
        loadLog(); // Reload data setelah menghapus
      }
    }

    loadLog();
  </script>
</body>
</html>